#!/usr/bin/perl
use strict;

=head1 NAME

spkpi-waterd-server-wrapper

=head1 DESCRIPTION

Instead of requiring spkpi-waterd-server to use the C version
of the YAML library, which adds complexity, this script loads
the YAML configuration and the exec's spkpi-waterd-server with
the required arguments.

=head1 AUTHOR

    Jeremiah Mahler <jmmahler@gmail.com>
    http://github.com/jmahler

=head1 COPYRIGHT

Copyright (c) 2014, Jeremiah Mahler. All Rights Reserved.
This module is free software.  It may be used, redistributed
and/or modified under the same terms as Perl itself.

=cut

use YAML::Syck;

my $dir = '../sprinklerpi';  # default
if (@ARGV) {
	$dir = shift @ARGV;
}

(-e $dir)
	or die "Required directory '$dir' does not exist!";

my $conf_file = "$dir/sprinklerpi.conf";

(-e "$conf_file")
	or die "Configuration file '$conf_file' does not exist!";

my $cfg = LoadFile($conf_file);

my $port = $cfg->{'port'};

my $bin = $ENV{'BIN'};
exec("$bin/spkpi-waterd-server $port $dir")
	or die "Unable to exec spkpi-waterd-server: $!";

